---

- name: Install and configure postsrsd
  tags: [ 'mail_postsrsd' ]
  block:

    - name: Install postsrsd
      ansible.builtin.apt:
        update_cache: yes
        install_recommends: no
        pkg: "{{ mail_postsrsd__packages }}"

    - name: Generate configuration files
      ansible.builtin.template:
        src: postsrsd.j2
        dest: /etc/default/postsrsd
        owner: root
        group: root
        mode: '644'
      notify:
        - Restart postgrey

    - name: Generate secret file
      ansible.builtin.copy:
        dest: /etc/postsrsd.secret
        content: "{{ mail_postsrsd__secret }}"
        owner: root
        group: root
        mode: 0600
      notify:
        - Restart postsrsd
