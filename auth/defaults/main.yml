---
# defaults file for roles/auth

auth_nsswitch_config: {}

#
# Substitutions
#

auth__enable: "{{ auth_enable | default(false) }}"

auth__authorized_keys_enable: "{{ auth_authorized_keys_enable | default(true) and auth__authorized_keys | length > 0 }}"
auth__authorized_keys: "{{ auth_authorized_keys | default([]) }}"

auth__ldap_enable: "{{ auth_ldap_enable | default(true) and auth__ldap_base | length > 0 }}"
auth__ldap_base: "{{ auth_ldap_base | default([]) }}"
auth__nslcd_configuration: "{{ auth_nslcd_configuration | default([]) }}"
auth__nslcd_host_filter: "{{ auth_nslcd_host_filter | default('') }}"

auth__nsswitch_enable: "{{ auth_nsswitch_enable | default(false) }}"

auth__sudoers_enable: "{{ auth_sudoers_enable | default(true) and ( auth__sudoers | length > 0 ) or ( auth__sudoers_files | length > 0) }}"
auth__sudoers: "{{ auth_sudoers | default({}) }}"
auth__sudoers_files: "{{ auth_sudoers_files | default({}) }}"

#
# Do not change from here
#
auth__nsswitch_config_default:
  passwd: [ 'files', 'ldap', 'systemd' ]
  group: [ 'files', 'ldap', 'systemd' ]
  shadow: [ 'files', 'ldap' ]
  gshadow: [ 'files' ]
  hosts:
  - 'files'
  - [ 'mdns4_minimal', '[NOTFOUND=return]' ]
  - [ 'mdns_minimal', '[NOTFOUND=return]' ]
  - [ 'dns', '[!UNAVAIL=return]' ]
  networks: [ 'files' ]
  protocols: [ 'db', 'files' ]
  services: [ 'db', 'files' ]
  ethers: [ 'db', 'files' ]
  rpc: [ 'db', 'files' ]
  netgroup: [ 'nis' ]

auth__nsswitch_config_combined: "{{ auth__nsswitch_config_default | combine(auth_nsswitch_config) }}"
