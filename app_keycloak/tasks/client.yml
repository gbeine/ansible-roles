---

- name: Create realm client ids
  tags: [ 'app_keycloak_config' ]
  block:

# See: https://docs.ansible.com/ansible/latest/collections/community/general/keycloak_client_module.html
    - name: Create or update Keycloak client
      tags: [ 'app_keycloak_config' ]
      community.general.keycloak_client:
        auth_keycloak_url: "{{ app_keycloak__auth_url }}"
        auth_realm: "{{ app_keycloak__auth_realm }}"
        auth_username: "{{ app_keycloak__auth_username }}"
        auth_password: "{{ app_keycloak__auth_password }}"
        realm: "{{ realm.realm }}"
        client_id: "{{ item.client_id }}"
        name: "{{ item.name | default(app_keycloak__client_default.name) }}"
        protocol: "{{ item.protocol | default(app_keycloak__client_default.protocol) }}"
        description: "{{ item.description | default(app_keycloak__client_default.description) }}"
        redirect_uris: "{{ item.redirect_uris }}"
        root_url: "{{ item.root_url | default(app_keycloak__client_default.root_url) }}"
        web_origins: "{{ item.web_origins }}"
      with_items: "{{ realm.clients }}"
