---
# tasks file for roles/bootstrap

- name: Generate interfaces configuration
  tags: [ 'configuration' ]
  ansible.builtin.template:
    src: etc/network/interfaces.j2
    dest: /etc/network/interfaces
    owner: root
    group: root
    mode: 0644

- name: Generate additional interfaces configuration
  tags: [ 'configuration' ]
  ansible.builtin.template:
    src: etc/network/interfaces.d/interface.j2
    dest: "/etc/network/interfaces.d/{{ item['priority'] }}-{{ item['name'] | default(item['interface']) }}"
    owner: root
    group: root
    mode: 0644
  with_items: "{{ bootstrap__network_interfaces }}"

- name: Bind sshd to address
  tags: [ 'configuration' ]
  when: bootstrap__network_bind_ssh | length > 0
  ansible.builtin.shell:
    cmd: "sed -i 's/#ListenAddress 0.0.0.0/ListenAddress {{bootstrap__network_bind_ssh}}/' sshd_config"
    chdir: /etc/ssh
  notify:
    - Restart sshd
