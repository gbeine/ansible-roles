---
# tasks file for roles/bootstrap

- name: Create Ansible state directory
  ansible.builtin.file:
    dest: /etc/ansible
    state: directory
    owner: root
    group: root
    mode: 0755

- name: Configure keyboard
  ansible.builtin.template:
    src: etc/default/keyboard.j2
    dest: /etc/default/keyboard
    owner: root
    group: root
    mode: 0644
  vars:
    keyboard_xkbmodel: "{{ bootstrap__keyboard_xkbmodel }}"
    keyboard_xkblayout: "{{ bootstrap__keyboard_xkblayout }}"
    keyboard_xkbvariant: "{{ bootstrap__keyboard_xkbvariant }}"
    keyboard_xkboptions: "{{ bootstrap__keyboard_xkboptions }}"
    keyboard_backspace: "{{ bootstrap__keyboard_backspace }}"

- name: Configure locale variables
  ansible.builtin.template:
    src: etc/default/locale.j2
    dest: /etc/default/locale
    owner: root
    group: root
    mode: 0644
  vars:
    locale_vars: "{{ bootstrap__locale_vars_combined }}"

- name: Configure locale.gen
  ansible.builtin.template:
    src: etc/locale.gen.j2
    dest: /etc/locale.gen
    owner: root
    group: root
    mode: 0644
  vars:
    locales: "{{ bootstrap__locales_combined }}"
  notify:
  - Generate locales

- name: Flush handlers
  meta: flush_handlers

- name: Configure timezone
  ansible.builtin.copy:
    dest: /etc/timezone
    content: |
      {{ bootstrap__timezone }}
    owner: root
    group: root
    mode: 0644

- name: Configure localtime
  ansible.builtin.file:
    src: "/usr/share/zoneinfo/{{ bootstrap__timezone }}"
    dest: /etc/localtime
    state: link

- name: Copy screen configuration
  ansible.builtin.copy:
    src: screenrc
    dest: /root/.screenrc
    mode: 0644

- name: Install default packages
  ansible.builtin.apt:
    name: "{{ item }}"
    state: present
  with_items: "{{ bootstrap__packages_combined }}"
