---
# defaults file for roles/php

php_packages: []
php_fpm_pools: {}

#
# Substitutions
#

php__enable: "{{ php_enable | default (false) }}"
php__flavor: "{{ php_flavor | default('fpm') }}"
php__version: "{{ php_version | default('7.3') }}"


#
# Do not change from here
#

#
# php.ini
#

php__ini_engine: "{{ php_ini_engine | default(true) }}"
php__ini_short_open_tag: "{{ php_ini_short_open_tag | default(false) }}"
php__ini_precision: "{{ php_ini_precision | default(14) }}"
php__ini_output_buffering: "{{ php_ini_output_buffering | default(4096) }}"
php__ini_zlib_output_compression: "{{ php_ini_zlib_output_compression | default(false) }}"
php__ini_implicit_flush: "{{ php_ini_implicit_flush | default(false) }}"
php__ini_unserialize_callback_func: "{{ php_ini_unserialize_callback_func | default('') }}"
php__ini_serialize_precision: "{{ php_ini_serialize_precision | default(-1) }}"
php__ini_disable_functions: "{{ php_ini_disable_functions | default('pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,pcntl_unshare') }}"
php__ini_disable_classes: "{{ php_ini_disable_classes | default('') }}"
php__ini_zend_enable_gc: "{{ php_ini_zend_enable_gc | default(true) }}"
php__ini_zend_exception_ignore_args: "{{ php_ini_zend_exception_ignore_args | default(true) }}"
php__ini_expose_php: "{{ php_ini_expose_php | default(false) }}"
php__ini_max_execution_time: "{{ php_ini_max_execution_time | default(30) }}"
php__ini_max_input_time: "{{ php_ini_max_input_time | default(60) }}"
php__ini_memory_limit: "{{ php_ini_memory_limit | default('128M') }}"
php__ini_error_reporting: "{{ php_ini_error_reporting | default('E_ALL & ~E_DEPRECATED & ~E_STRICT') }}"
php__ini_display_errors: "{{ php_ini_display_errors | default(false) }}"
php__ini_display_startup_errors: "{{ php_ini_display_startup_errors | default(false) }}"
php__ini_log_errors: "{{ php_ini_log_errors | default(true) }}"
php__ini_log_errors_max_len: "{{ php_ini_log_errors_max_len | default(1024) }}"
php__ini_ignore_repeated_errors: "{{ php_ini_ignore_repeated_errors | default(false) }}"
php__ini_ignore_repeated_source: "{{ php_ini_ignore_repeated_source | default(false) }}"
php__ini_report_memleaks: "{{ php_ini_report_memleaks | default(true) }}"
php__ini_variables_order: "{{ php_ini_variables_order | default('GPCS') }}"
php__ini_request_order: "{{ php_ini_request_order | default('GP') }}"
php__ini_register_argc_argv: "{{ php_ini_register_argc_argv | default(false) }}"
php__ini_auto_globals_jit: "{{ php_ini_auto_globals_jit | default(true) }}"
php__ini_post_max_size: "{{ php_ini_post_max_size | default('8M') }}"
php__ini_auto_prepend_file: "{{ php_ini_auto_prepend_file | default('') }}"
php__ini_auto_append_file: "{{ php_ini_auto_append_file | default('') }}"
php__ini_default_mimetype: "{{ php_ini_default_mimetype | default('text/html') }}"
php__ini_default_charset: "{{ php_ini_default_charset | default('UTF-8') }}"
php__ini_doc_root: "{{ php_ini_doc_root | default('') }}"
php__ini_user_dir: "{{ php_ini_user_dir | default('') }}"
php__ini_enable_dl: "{{ php_ini_enable_dl | default(false) }}"
php__ini_file_uploads: "{{ php_ini_file_uploads | default(true) }}"
php__ini_upload_max_filesize: "{{ php_ini_upload_max_filesize | default('2M') }}"
php__ini_max_file_uploads: "{{ php_ini_max_file_uploads | default(20) }}"
php__ini_allow_url_fopen: "{{ php_ini_allow_url_fopen | default(true) }}"
php__ini_allow_url_include: "{{ php_ini_allow_url_include | default(false) }}"
php__ini_default_socket_timeout: "{{ php_ini_default_socket_timeout | default(60) }}"
php__ini_cli_server_color: "{{ php_ini_cli_server_color | default(true) }}"
php__ini_pdo_mysql_default_socket: "{{ php_ini_pdo_mysql_default_socket | default('') }}"
php__ini_smtp: "{{ php_ini_smtp | default('localhost') }}"
php__ini_smtp_port: "{{ php_ini_smtp_port | default(25) }}"
php__ini_mail_add_x_header: "{{ php_ini_mail_add_x_header | default(false) }}"

php__ini_odbc_allow_persistent: "{{ php_ini_odbc_allow_persistent | default(true) }}"
php__ini_odbc_check_persistent: "{{ php_ini_odbc_check_persistent | default(true) }}"
php__ini_odbc_max_persistent: "{{ php_ini_odbc_max_persistent | default(-1) }}"
php__ini_odbc_max_links: "{{ php_ini_odbc_max_links | default(-1) }}"
php__ini_odbc_defaultlrl: "{{ php_ini_odbc_defaultlrl | default(4096) }}"
php__ini_odbc_defaultbinmode: "{{ php_ini_odbc_defaultbinmode | default(1) }}"

php__ini_mysqli_max_persistent: "{{ php_ini_mysqli_max_persistent | default(-1) }}"
php__ini_mysqli_allow_persistent: "{{ php_ini_mysqli_allow_persistent | default(true) }}"
php__ini_mysqli_max_links: "{{ php_ini_mysqli_max_links | default(-1) }}"
php__ini_mysqli_default_port: "{{ php_ini_mysqli_default_port | default(3306) }}"
php__ini_mysqli_default_socket: "{{ php_ini_mysqli_default_socket | default('') }}"
php__ini_mysqli_default_host: "{{ php_ini_mysqli_default_host | default('') }}"
php__ini_mysqli_default_user : "{{ php_ini_mysqli_default_user  | default('') }}"
php__ini_mysqli_default_pw: "{{ php_ini_mysqli_default_pw | default('') }}"
php__ini_mysqli_reconnect: "{{ php_ini_mysqli_reconnect | default(false) }}"

php__ini_mysqlnd_collect_statistics: "{{ php_ini_mysqlnd_collect_statistics | default(true) }}"
php__ini_mysqlnd_collect_memory_statistics: "{{ php_ini_mysqlnd_collect_memory_statistics | default(false) }}"

php__ini_pgsql_allow_persistent: "{{ php_ini_pgsql_allow_persistent | default(true) }}"
php__ini_pgsql_auto_reset_persistent: "{{ php_ini_pgsql_auto_reset_persistent | default(false) }}"
php__ini_pgsql_max_persistent: "{{ php_ini_pgsql_max_persistent | default(-1) }}"
php__ini_pgsql_max_links: "{{ php_ini_pgsql_max_links | default(-1) }}"
php__ini_pgsql_ignore_notice: "{{ php_ini_pgsql_ignore_notice | default(0) }}"
php__ini_pgsql_log_notice: "{{ php_ini_pgsql_log_notice | default(0) }}"

php__ini_bcmath_scale: "{{ php_ini_bcmath_scale | default(0) }}"

php__ini_session_save_handler: "{{ php_ini_session_save_handler | default('files') }}"
php__ini_session_use_strict_mode: "{{ php_ini_session_use_strict_mode | default(0) }}"
php__ini_session_use_cookies: "{{ php_ini_session_use_cookies | default(1) }}"
php__ini_session_use_only_cookies: "{{ php_ini_session_use_only_cookies | default(1) }}"
php__ini_session_name: "{{ php_ini_session_name | default('PHPSESSID') }}"
php__ini_session_auto_start: "{{ php_ini_session_auto_start | default(0) }}"
php__ini_session_cookie_lifetime: "{{ php_ini_session_cookie_lifetime | default(0) }}"
php__ini_session_cookie_path: "{{ php_ini_session_cookie_path | default('/') }}"
php__ini_session_cookie_domain: "{{ php_ini_session_cookie_domain | default('') }}"
php__ini_session_cookie_httponly: "{{ php_ini_session_cookie_httponly | default('') }}"
php__ini_session_cookie_samesite: "{{ php_ini_session_cookie_samesite | default('') }}"
php__ini_session_serialize_handler: "{{ php_ini_session_serialize_handler | default('php') }}"
php__ini_session_gc_probability: "{{ php_ini_session_gc_probability | default(0) }}"
php__ini_session_gc_divisor: "{{ php_ini_session_gc_divisor | default(1000) }}"
php__ini_session_gc_maxlifetime: "{{ php_ini_session_gc_maxlifetime | default(1440) }}"
php__ini_session_referer_check: "{{ php_ini_session_referer_check | default('') }}"
php__ini_session_cache_limiter: "{{ php_ini_session_cache_limiter | default('nocache') }}"
php__ini_session_cache_expire: "{{ php_ini_session_cache_expire | default(180) }}"
php__ini_session_use_trans_sid: "{{ php_ini_session_use_trans_sid | default(0) }}"
php__ini_session_sid_length: "{{ php_ini_session_sid_length | default(26) }}"
php__ini_session_trans_sid_tags: "{{ php_ini_session_trans_sid_tags | default('a=href,area=href,frame=src,form=') }}"
php__ini_session_sid_bits_per_character: "{{ php_ini_session_sid_bits_per_character | default(5) }}"

php__ini_zend_assertions: "{{ php_ini_zend_assertions | default(-1) }}"

php__ini_tidy_clean_output: "{{ php_ini_tidy_clean_output | default(false) }}"

php__ini_soap_wsdl_cache_enabled: "{{ php_ini_soap_wsdl_cache_enabled | default(1) }}"
php__ini_soap_wsdl_cache_dir: "{{ php_ini_soap_wsdl_cache_dir | default('/tmp') }}"
php__ini_soap_wsdl_cache_ttl: "{{ php_ini_soap_wsdl_cache_ttl | default(86400) }}"
php__ini_soap_wsdl_cache_limit: "{{ php_ini_soap_wsdl_cache_limit | default(5) }}"

php__ini_ldap_max_links: "{{ php_ini_ldap_max_links | default(-1) }}"

#
# php-fpm.conf
#

php__fpm_conf_pid: "{{ php_fpm_conf_pid | default('/run/php/php' + php__version + '-fpm.pid') }}"
php__fpm_conf_error_log: "{{ php_fpm_conf_error_log | default('/var/log/php' + php__version + '-fpm.log') }}"
php__fpm_conf_syslog_facility: "{{ php_fpm_conf_syslog_facility | default('daemon') }}"
php__fpm_conf_syslog_ident: "{{ php_fpm_conf_syslog_ident | default('php-fpm') }}"
php__fpm_conf_log_level: "{{ php_fpm_conf_log_level | default('notice') }}"
php__fpm_conf_log_limit: "{{ php_fpm_conf_log_limit | default(4096) }}"
php__fpm_conf_log_buffering: "{{ php_fpm_conf_log_buffering | default(false) }}"
php__fpm_conf_emergency_restart_threshold: "{{ php_fpm_conf_emergency_restart_threshold | default(0) }}"
php__fpm_conf_emergency_restart_interval: "{{ php_fpm_conf_emergency_restart_interval | default(0) }}"
php__fpm_conf_process_control_timeout: "{{ php_fpm_conf_process_control_timeout | default(0) }}"
php__fpm_conf_process_max: "{{ php_fpm_conf_process_max | default(128) }}"
php__fpm_conf_process_priority: "{{ php_fpm_conf_process_priority | default(-19) }}"
php__fpm_conf_daemonize: "{{ php_fpm_conf_daemonize | default(true) }}"
php__fpm_conf_rlimit_files: "{{ php_fpm_conf_rlimit_files | default(1024) }}"
php__fpm_conf_rlimit_core: "{{ php_fpm_conf_rlimit_core | default(0) }}"
php__fpm_conf_events_mechanism: "{{ php_fpm_conf_events_mechanism | default('epoll') }}"
php__fpm_conf_systemd_interval: "{{ php_fpm_conf_systemd_interval | default(10) }}"
php__fpm_conf_include: "{{ php_fpm_conf_include | default(php__etc_dir + '/' + php__version + '/fpm/pool.d/*.conf') }}"

#
# pool.conf
#

php__fpm_pools_default:
  www:
    prefix: '/path/to/pools/$pool'
    user: 'www-data'
    group: 'www-data'
    listen: '/run/php/php{{ php__version }}-fpm.sock'
    listen_backlog: 511
    listen_owner: 'www-data'
    listen_group: 'www-data'
    listen_mode: '0660'
    listen_acl_users: ''
    listen_acl_groups: ''
    listen_allowed_clients: '127.0.0.1'
    process_priority: -19
    process_dumpable: true
    pm: 'dynamic'
    pm_max_children: 5
    pm_start_servers: 2
    pm_min_spare_servers: 1
    pm_max_spare_servers: 3
    pm_process_idle_timeout: '10s'
    pm_max_requests: 500
    pm_status_path: '/status'
    ping_path: '/ping'
    ping_response: 'pong'
    access_log: 'log/$pool.access.log'
    access_format: '%R - %u %t \"%m %r%Q%q\" %s %f %{mili}d %{kilo}M %C%%'
    slowlog: 'log/$pool.log.slow'
    request_slowlog_timeout: 0
    request_slowlog_trace_depth: 20
    request_terminate_timeout: 0
    request_terminate_timeout_track_finished: false
    rlimit_files: 1024
    rlimit_core: 0
    chroot: ''
    chdir: '/var/www'
    catch_workers_output: true
    decorate_workers_output: false
    clear_env: true
    clean_env: {}
    security_limit_extensions: '.php .php3 .php4 .php5 .php7'

php__packages_default:
- php-pear

php__etc_dir: '/etc/php'

php__flavor_map:
  fpm:
    packages:
    - php-fpm
  apache:
    packages:
    - libapache2-mod-php

php__flavor_selected: "{{ php__flavor_map[php__flavor] }}"

php__packages_combined: "{{ php_packages + php__packages_default + php__flavor_selected.packages }}"

php__fpm_pools_combined: "{{ php__fpm_pools_default | combine(php_fpm_pools, recursive=True) }}"
