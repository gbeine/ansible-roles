---

samba__server_enable: "{{ samba_server_enable | default(false) }}"
samba__winbind_enable: "{{ samba_winbind_enable | default(false) }}"
samba__smbldap_enable: "{{ samba_smbldap_enable | default(false) }}"
samba__server_netlogon: "{{ samba_server_netlogon | default(false) }}"

samba__server_workgroup: "{{ samba_server_workgroup | default('WORKGROUP') }}"
samba__server_string: "{{ samba_server_string | default('Samba Server') }}"
samba__netbios_name: "{{ samba_server_netbios_name | default('Samba Server') }}"
samba__server_interfaces: "{{ samba_server_interfaces | default([]) }}"
samba__server_bind_interfaces_only: "{{ samba_server_bind_interfaces_only | default(false) }}"
samba__server_hosts_allow: "{{ samba_server_hosts_allow | default([]) }}"
samba__server_protocol: "{{ samba_server_protocol | default('SMB3_11') }}"
samba__server_min_protocol: "{{ samba_server_min_protocol | default(samba__server_protocol) }}"
samba__server_max_protocol: "{{ samba_server_max_protocol | default(samba__server_protocol) }}"
# Fix for CVE-2017-7494 in Samba versions from 3.5.0 and before 4.6.4
# https://access.redhat.com/security/cve/cve-2017-7494
samba__server_nt_pipe_support: "{{ samba_server_nt_pipe_support | default(false) }}"
samba__server_ea_support: "{{ samba_server_ea_support | default(false) }}"
samba__server_vfs_objects: "{{ samba_server_vfs_objects | default([]) }}"

samba__server_log_file: "{{ samba_server_log_file | default('/var/log/samba/log.%m') }}"
samba__server_max_log_size: "{{ samba_server_max_log_size | default(1000) }}"
samba__server_logging: "{{ samba_server_logging | default('file') }}"
samba__server_panic_action: "{{ samba_server_panic_action | default('/usr/share/samba/panic-action %d') }}"
samba__server_log_level: "{{ samba_server_log_level | default('1') }}"
samba__server_debug_pid: "{{ samba_server_debug_pid | default(false) }}"
samba__server_debug_uid: "{{ samba_server_debug_uid | default(false) }}"
samba__server_utmp: "{{ samba_server_utmp | default(false) }}"

samba__server_apple_extensions: "{{ samba_server_apple_extensions | default(false) }}"
samba__server_apple_nfs_aces: "{{ samba_server_apple_nfs_aces | default(false) }}"
samba__server_apple_copyfile: "{{ samba_server_apple_copyfile | default(false) }}"
samba__server_apple_model: "{{ samba_server_apple_model | default('MacSamba') }}"
samba__server_apple_resource: "{{ samba_server_apple_resource | default('xattr') }}"
samba__server_apple_metadata: "{{ samba_server_apple_metadata | default('stream') }}"
samba__server_apple_locking: "{{ samba_server_apple_locking | default('none') }}"
samba__server_apple_encoding: "{{ samba_server_apple_encoding | default('private') }}"
samba__server_apple_veto_appledouble: "{{ samba_server_apple_veto_appledouble | default(false) }}"
samba__server_apple_posix_rename: "{{ samba_server_apple_posix_rename | default(true) }}"
samba__server_apple_aapl_rsize: "{{ samba_server_apple_aapl_rsize | default(true) }}"
samba__server_apple_aapl_finder_info: "{{ samba_server_apple_aapl_finder_info | default(true) }}"
samba__server_apple_aapl_max_access: "{{ samba_server_apple_aapl_max_access | default(true) }}"
samba__server_apple_wipe_intentionally_left_blank_rfork: "{{ samba_server_apple_wipe_intentionally_left_blank_rfork | default(true) }}"
samba__server_apple_delete_empty_adfiles: "{{ samba_server_apple_delete_empty_adfiles | default(true) }}"
samba__server_apple_zero_file_id: "{{ samba_server_apple_zero_file_id | default(true) }}"

samba__server_role: "{{ samba_server_role | default('standalone server') }}"
samba__server_security: "{{ samba_server_security | default('user') }}"
samba__server_domain_logons: "{{ samba_server_domain_logons | default(false) }}"
samba__server_os_level: "{{ samba_server_os_level | default('64') }}"
samba__server_obey_pam_restrictions: "{{ samba_server_obey_pam_restrictions | default(true) }}"
samba__server_unix_password_sync: "{{ samba_server_unix_password_sync | default(true) }}"
samba__server_ldap_password_sync: "{{ samba_server_unix_password_sync | default(not samba__server_unix_password_sync) }}"
samba__server_passwd_program: "{{ samba_server_passwd_program | default('/usr/bin/passwd %u') }}"
samba__server_passwd_chat: "{{ samba_server_passwd_chat | default('*Enter\\snew\\s*\\spassword:* %n\\n *Retype\\snew\\s*\\spassword:* %n\\n *password\\supdated\\ssuccessfully* .') }}"
samba__server_pam_password_change: "{{ samba_server_pam_password_change | default(true) }}"
samba__server_realm: "{{ samba_server_realm | default(samba__server_workgroup) }}"
samba__server_passdb_backend: "{{ samba_server_passdb_backend | default('tdbsam') }}"
samba__server_guest_account: "{{ samba_server_guest_account | default('') }}"
samba__server_map_to_guest: "{{ samba_server_map_to_guest | default('bad user') }}"
samba__server_username_map:  "{{ samba_username_map | default({}) }}"

samba__server_ldap_ssl: "{{ samba_server_ldap_ssl | default('start tls') }}"
samba__server_ldap_admin_dn: "{{ samba_server_ldap_admin_dn | default('cn=Manager,dc=example,dc=com') }}"
samba__server_ldap_delete_dn: "{{ samba_server_ldap_delete_dn | default(false) }}"
samba__server_ldap_suffix: "{{ samba_server_ldap_suffix | default('dc=example,dc=com') }}"
samba__server_ldap_user_suffix: "{{ samba_server_ldap_user_suffix | default('ou=Users') }}"
samba__server_ldap_group_suffix: "{{ samba_server_ldap_group_suffix | default('ou=Groups') }}"
samba__server_ldap_machine_suffix: "{{ samba_server_ldap_machine_suffix | default('ou=Computers') }}"
samba__server_ldap_idmap_suffix: "{{ samba_server_ldap_idmap_suffix | default('ou=Idmap') }}"

samba__server_logon_path: "{{ samba_server_logon_path | default('\\\\%N\\%U\\profile') }}"
samba__server_logon_drive: "{{ samba_server_logon_drive | default('H:') }}"
samba__server_logon_home: "{{ samba_server_logon_home | default('\\\\%N\\%U') }}"
samba__server_logon_script: "{{ samba_server_logon_script | default('logon.cmd') }}"
samba__server_add_user_script: "{{ samba_server_add_user_script | default('/usr/sbin/adduser --quiet --disabled-password --gecos \"\" %u') }}"
samba__server_rename_user_script: "{{ samba_server_rename_user_script | default('') }}"
samba__server_delete_user_script: "{{ samba_server_delete_user_script | default('') }}"
samba__server_set_primary_group_script: "{{ samba_server_set_primary_group_script | default('') }}"
samba__server_add_machine_script: "{{ samba_server_add_machine_script | default('/usr/sbin/useradd -g machines -c \"%u machine account\" -d /var/lib/samba -s /bin/false %u') }}"
samba__server_add_group_script: "{{ samba_server_add_group_script | default('/usr/sbin/addgroup --force-badname %g') }}"
samba__server_delete_group_script: "{{ samba_server_delete_group_script | default('') }}"
samba__server_add_user_to_group_script: "{{ samba_server_add_user_to_group_script | default('') }}"
samba__server_delete_user_from_group_script: "{{ samba_server_delete_user_from_group_script | default('') }}"

samba__server_wins_support: "{{ samba_server_wins_support | default(samba__winbind_enable) }}"
samba__server_wins_server: "{{ samba_server_wins_server | default('') }}"
samba__server_wins_proxy: "{{ samba_server_wins_proxy | default(false) }}"
samba__server_dns_proxy: "{{ samba_server_dns_proxy | default(false) }}"
samba__server_local_master: "{{ samba_server_local_master | default(false) }}"
samba__server_domain_master: "{{ samba_server_domain_master | default(false) }}"
samba__server_preferred_master: "{{ samba_server_preferred_master | default(false) }}"

samba__server_load_printers: "{{ samba_server_load_printers | default(false) }}"
samba__server_printing: "{{ samba_server_printing | default('bsd') }}"
samba__server_printcap_name: "{{ samba_server_printcap_name | default('/dev/null') }}"
samba__server_disable_spoolss: "{{ samba_server_disable_spoolss | default(samba__server_load_printers | ternary(false, true) ) }}"
samba__server_cups_server: "{{ samba_server_cups_server | default('localhost:631') }}"

samba__server_usershare_max_shares: "{{ samba_server_usershare_max_shares | default(100) }}"
samba__server_usershare_allow_guests: "{{ samba_server_usershare_allow_guests | default(true) }}"

samba__server_machines: "{{ samba_server_machines | default([]) }}"
samba__server_winbind_defaults: "{{ samba_server_winbind_defaults | default({}) }}"

samba__users:  "{{ samba_users | default({}) }}"

samba__server_shares_default:
  homes:
    comment: Home Directories
    browseable: true
    read_only: true
    create_mask: '0700'
    directory_mask: '0700'
    valid_users: '%S'
  printers:
    comment: All Printers
    browseable: false
    path: /var/spool/samba
    printable: true
    guest_ok: false
    read_only: true
    create_mask: '0700'
  print$:
   comment: Printer Drivers
   path: /var/lib/samba/printers
   browseable: true
   read_only: true
   guest_ok: false

samba__server_shares_combined: "{{ samba__server_shares_default | combine(samba_server_shares|default({})) }}"

samba__smbldap_sid: "{{ samba__smbldap_localsid | default('') }}"
samba__smbldap_samba_domain: "{{ samba_server_workgroup }}"
samba__smbldap_slave: "{{ samba_smbldap_slave | default(ldap_uri) }}"
samba__smbldap_master: "{{ samba_smbldap_master | default(ldap_uri) }}"
samba__smbldap_ldap_tls: "{{ samba_smbldap_ldap_tls | default(true) }}"
samba__smbldap_verify: "{{ samba_smbldap_verify | default('require') }}"
samba__smbldap_cafile: "{{ samba_smbldap_cafile | default('/etc/smbldap-tools/ca.pem') }}"
samba__smbldap_clientcert: "{{ samba_smbldap_clientcert | default('/etc/smbldap-tools/smbldap-tools.example.com.pem') }}"
samba__smbldap_clientkey: "{{ samba_smbldap_clientkey | default('/etc/smbldap-tools/smbldap-tools.example.com.key') }}"
samba__smbldap_suffix: "{{ samba__server_ldap_suffix }}"
samba__smbldap_usersdn: "{{ samba__server_ldap_user_suffix }},${suffix}"
samba__smbldap_computersdn: "{{ samba__server_ldap_machine_suffix }},${suffix}"
samba__smbldap_groupsdn: "{{ samba__server_ldap_group_suffix }},${suffix}"
samba__smbldap_idmapdn: "{{ samba__server_ldap_idmap_suffix }},${suffix}"
samba__smbldap_samba_unix_id_pooldn: "sambaDomainName=${sambaDomain},${suffix}"
samba__smbldap_scope: "{{ samba_smbldap_scope | default('sub') }}"
samba__smbldap_password_hash: "{{ samba_smbldap_password_hash | default('SSHA') }}"
samba__smbldap_password_crypt_salt_format: "{{ samba_smbldap_password_crypt_salt_format | default('%s') }}"

samba__smbldap_userLoginShell: ="/bin/bash"
samba__smbldap_userHome: ="/home/%U"
samba__smbldap_userHomeDirectoryMode: ="700"
samba__smbldap_userGecos: ="System User"
samba__smbldap_defaultUserGid: ="513"
samba__smbldap_defaultComputerGid: ="515"
samba__smbldap_skeletonDir: ="/etc/skel"
samba__smbldap_shadowAccount: ="1"
samba__smbldap_defaultMaxPasswordAge: ="45"

samba__smbldap_user_smb_home: ="\\PDC-SRV\%U"
samba__smbldap_user_profile: ="\\PDC-SRV\profiles\%U"
samba__smbldap_user_home_drive: "{{ samba__server_logon_drive }}"
samba__smbldap_user_script: "{{ samba__server_logon_script }}"
samba__smbldap_mail_domain: ="example.com"
samba__smbldap_lanman_password: "{{ samba_smbldap_lanman_password | default(false) }}"

samba__smbldap_with_smbpasswd: "{{ samba_smbldap_with_smbpasswd | default(false) }}"
samba__smbldap_smbpasswd: "{{ samba_smbldap_smbpasswd | default('/usr/bin/smbpasswd') }}"
samba__smbldap_with_slappasswd: "{{ samba_smbldap_with_slappasswd | default(false) }}"
samba__smbldap_slappasswd: "{{ samba_smbldap_slappasswd | default('/usr/sbin/slappasswd') }}"
samba__smbldap_no_banner: "{{ samba_smbldap_no_banner | default(false) }}"

samba__scripts_selection: "{{ samba__smbldap_enable | ternary('smbldap', 'default') }}"

samba__scripts:
  default:
    passwd_program: '/usr/bin/passwd "%u"'
    passwd_chat: '*Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .'
    add_user_script: '/usr/sbin/adduser --quiet --disabled-password --gecos "" %u'
    rename_user_script: ''
    delete_user_script: ''
    set_primary_group_script: ''
    add_machine_script: '/usr/sbin/useradd -g machines -c "%u machine account" -d /var/lib/samba -s /bin/false "%u"'
    add_group_script: '/usr/sbin/addgroup --force-badname "%g"'
    delete_group_script: ''
    add_user_to_group_script: ''
    delete_user_from_group_script: ''
  smbldap:
    passwd_program: '/usr/sbin/smbldap-passwd -u "%u"'
    passwd_chat: '"Changing *\nNew password*" %n\n "*Retype new password*" %n\n'
    add_user_script: '/usr/sbin/smbldap-useradd -m "%u" -t 1'
    rename_user_script: '/usr/sbin/smbldap-usermod -r "%unew" "%uold"'
    delete_user_script: '/usr/sbin/smbldap-userdel "%u"'
    set_primary_group_script: '/usr/sbin/smbldap-usermod -g "%g" "%u"'
    add_machine_script: '/usr/sbin/smbldap-useradd -w "%u" -t 1'
    add_group_script: '/usr/sbin/smbldap-groupadd -p "%g"'
    delete_group_script: '/usr/sbin/smbldap-groupdel "%g"'
    add_user_to_group_script: '/usr/sbin/smbldap-groupmod -m "%u" "%g"'
    delete_user_from_group_script: '/usr/sbin/smbldap-groupmod -x "%u" "%g"'

samba__shares_netlogon_default:
  comment: Network Logon Service
  path: /home/samba/netlogon
  guest_ok: true
  read only: true

samba__shares_profiles_default:
  comment: Users profiles
  path: /home/samba/profiles
  guest_ok: false
  browsable: false
  create_mask: '0600'
  directory_mask: '0700'

samba__server_packages:
- samba
- samba-vfs-modules
- smbclient

samba__winbind_packages:
- winbind

samba__smbldap_packages:
- smbldap-tools
