---
# defaults file for roles/mysql

mysql_client_packages: []
mysql_server_packages: []

#
# Substitutions
#

mysql__enable: "{{ mysql_enable | default (false) }}"
mysql__client_enable: "{{ mysql_client_enable | default (mysql__enable or mysql__server_enable) }}"
mysql__server_enable: "{{ mysql_server_enable | default (mysql__enable) }}"
mysql__accounts: "{{ mysql_accounts | default ([]) }}"
mysql__databases: "{{ mysql_databases | default ([]) }}"
mysql__password: "{{ vault__mysql_password | default({}) }}"

mysql__flavor: "{{ mysql_flavor | default('mariadb') }}"

#
# Do not change from here
#

mysql__client_packages_default: "{{ mysql__client_packages_flavors[mysql__flavor] }}"

mysql__client_packages_flavors:
  mariadb:
  - mariadb-client
  mysql80:
  - mysql-client
  - mysql-client-8.0

mysql__server_packages_default:  "{{ mysql__server_packages_flavors[mysql__flavor] }}"

mysql__server_packages_flavors:
  mariadb:
  - mariadb-server
  - python3-pymysql
  - python3-cryptography
  - libdbd-mariadb-perl
  mysql80:
  - mysql-server
  - mysql-server-8.0
  - python3-pymysql
  - python3-cryptography

mysql__server_password_reset:
  mariadb: "mysql -e 'SET PASSWORD = PASSWORD(\"{{ mysql__password.root }}\"); FLUSH PRIVILEGES;' || mysql --password={{ mysql__password.root }} -e 'SET PASSWORD = PASSWORD(\"{{ mysql__password.root }}\"); FLUSH PRIVILEGES;'"
#  mysql80: "/usr/bin/mysql --defaults-file=/etc/mysql/debian.cnf -e 'ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY \"{{ mysql__password.root }}\"; FLUSH PRIVILEGES;'"
#  mysql80: "mysql -e 'SET PASSWORD = \"{{ mysql__password.root }}\"; FLUSH PRIVILEGES;' || mysql --password={{ mysql__password.root }} -e 'SET PASSWORD = \"{{ mysql__password.root }}\"; FLUSH PRIVILEGES;'"

mysql__client_packages_combined: "{{ mysql__client_packages_default + mysql_client_packages}}"
mysql__server_packages_combined: "{{ mysql__server_packages_default + mysql_server_packages}}"
