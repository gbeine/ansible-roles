---
# tasks file for roles/icinga

- name: Initialize zone
  tags: [ 'icinga' ]
  block:

  - name: Create zone directory
    ansible.builtin.file:
      dest: "/etc/icinga2/zones.d/{{ zone.key }}"
      state: directory

  - name: Generate configuration files for master and standalone
    tags: [ 'configuration' ]
    ansible.builtin.template:
      src: "{{ item.src }}"
      dest: "{{ item.dest }}"
      mode: 0644
    vars:
      type: "{{ item.class | default('undefined') }}"
      objects: "{{ item.objects | default({}) }}"
    with_items:
    - src: objects.conf.j2
      dest: /etc/icinga2/zones.d/{{ zone.key }}/hosts.conf
      objects: "{{ zone.value.hosts | default({}) }}"
      class: Host
    - src: applications.conf.j2
      dest: /etc/icinga2/zones.d/{{ zone.key }}/services.conf
      objects: "{{ zone.value.services | default({}) }}"
      class: Service
