---
# defaults file for roles/backup

#
# backup variables
#
backup__enable: "{{ backup_enable | default(false) }}"
backup__logfile: "{{ backup_logfile | default('/var/log/backup-daily.log') }}"
backup__error_logfile: "{{ backup_error_logfile | default('/var/log/backup-error.log') }}"
backup__target_directory: "{{ backup_target_directory | default('/mnt/backup') }}"

#
# variables for backup on NFS shares
#
backup__nfs_client_enable: "{{ backup_nfs_client_enable | default(false) }}"
backup__nfs_client_src: "{{ backup_nfs_client_src | default('') }}"

#
# variables for backup via SSH/SCP/SFTP
#
backup__ssh_client_enable: "{{ backup_ssh_client_enable | default(false) }}"
backup__ssh_user: "{{ backup_ssh_user | default('backup') }}"
backup__ssh_key_size: "{{ backup_ssh_key_size | default(4096) }}"
backup__ssh_key_name: "{{ backup_ssh_key_name | default('backup') }}"
backup__ssh_comment: "{{ backup_ssh_comment | default('backup over SSH') }}"
backup__ssh_password: "{{ vault__backup_ssh_password | default('') }}"

#
# borgbackup variables
#
backup__borg_enable: "{{ backup_borg_enable | default(false) }}"
backup__borg_password: "{{ vault__backup_borg_password | default('') }}"
backup__borg_rsh: "{{ backup_borg_rsh | default(backup__borg_rsh_default) }}"
backup__borg_backup_dir: "{{ backup_borg_backup_dir | default(backup__target_directory) }}"
backup__borg_cache_dir: "{{ backup_borg_cache_dir | default('') }}"
backup__borg_options: "{{ backup_borg_options | default('-s -v -p') }}"
backup__borg_include: "{{ backup_borg_include | default(backup__borg_include_default) }}"
backup__borg_exclude: "{{ backup_borg_exclude | default(backup__borg_exclude_default) }}"

#
# MySQL variables
#
backup__mysql_enable: "{{ backup_mysql_enable | default(false) }}"
backup__mysql_compress: "{{ backup_mysql_compress | default(true) }}"
backup__mysql_replication: "{{ backup_mysql_replication | default(false) }}"
backup__mysql_backup_dir: "{{ backup_mysql_backup_dir | default('/var/backup/mysql') }}"
backup__mysql_host: "{{ backup_mysql_host | default('localhost') }}"
backup__mysql_user: "{{ backup_mysql_user | default('_backup_') }}"
backup__mysql_password: "{{ vault__backup_mysql_password | default('') }}"
backup__mysql_ignore_databases: "{{ backup_mysql_ignore_databases | default(backup__mysql_ignore_databases_default) }}"
backup__mysql_keep_days: "{{ backup_mysql_keep_days | default('14') }}"

#
# Do not change from here
#
backup__ssh_key_path: "/tmp/{{ backup__ssh_key_name }}"
backup__borg_rsh_default: "ssh -i ~/.ssh/{{ backup__ssh_key_name }} -oStrictHostKeyChecking=no"
backup__borg_exclude_default: []
backup__borg_include_default:
- /etc
- /home
- /root
- /usr/local/etc
- /var/log

backup__mysql_ignore_databases_default:
- information_schema
- performance_schema
- sys


backup__scripts:
- 900.backup
- 910.backup.git
- 910.backup.grafana
- 910.backup.influxdb
- 910.backup.mysql
- 910.backup.postgresql
- 910.backup.tiddlywiki
- 950.backup.borgbackup

backup__nfs_client_packages:
- nfs-common
- nfs4-acl-tools

backup__ssh_client_packages:
- sshpass

backup__borg_packages:
- borgbackup

backup__mysql_packages:
- mariadb-client

backup__logrotate_files:
  - name: backup
    definitions:
      - logs:
          - "{{ backup__logfile }}"
          - "{{ backup__error_logfile }}"
        options:
          - daily
          - rotate 28
          - compress
          - delaycompress
          - missingok
          - notifempty
