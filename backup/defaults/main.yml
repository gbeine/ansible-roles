---
# defaults file for roles/backup

#
# backup variables
#
backup__enable: "{{ backup_enable | default(false) }}"
backup__dir: "{{ backup_dir | default('/usr/local/lib/backup') }}"
backup__logfile: "{{ backup_logfile | default('/var/log/backup-daily.log') }}"
backup__error_logfile: "{{ backup_error_logfile | default('/var/log/backup-error.log') }}"
backup__target_directory: "{{ backup_target_directory | default('/mnt/backup') }}"

#
# variables for backup on NFS shares
#
backup__nfs_enable: "{{ backup_nfs_enable | default(false) and backup__nfs_src| length > 0 }}"
backup__nfs_src: "{{ backup_nfs_src | default('') }}"
backup__nfs_path: "{{ backup_nfs_path | default(backup__target_directory) }}"
backup__nfs_options: "{{ backup_nfs_options | default('rw,sync,hard,intr') }}"

#
# variables for backup via SSH/SCP/SFTP
#
backup__ssh_client_enable: "{{ backup_ssh_client_enable | default(false) }}"
backup__ssh_user: "{{ backup_ssh_user | default('backup') }}"
backup__ssh_host: "{{ backup_ssh_host | default('') }}"
backup__ssh_key_size: "{{ backup_ssh_key_size | default(4096) }}"
backup__ssh_key_name: "{{ backup_ssh_key_name | default('backup') }}"
backup__ssh_comment: "{{ backup_ssh_comment | default('backup over SSH') }}"
backup__ssh_password: "{{ vault__backup_ssh_password | default('') }}"
backup__ssh_known_hosts: "{{ backup_ssh_known_hosts | default([]) }}"

#
# borgbackup variables
#
backup__borg_enable: "{{ backup_borg_enable | default(false) }}"
backup__borg_password: "{{ vault__backup_borg_password | default('') }}"
backup__borg_rsh: "{{ backup_borg_rsh | default(backup__borg_rsh_default) }}"
backup__borg_backup_dir: "{{ backup_borg_backup_dir | default(backup__target_directory) }}"
backup__borg_cache_dir: "{{ backup_borg_cache_dir | default('/var/cache/borg') }}"
backup__borg_options: "{{ backup_borg_options | default('-s -v -p') }}"
backup__borg_include: "{{ backup_borg_include | default(backup__borg_include_default) }}"
backup__borg_exclude: "{{ backup_borg_exclude | default(backup__borg_exclude_default) }}"

#
# MySQL variables
#
backup__mysql_enable: "{{ backup_mysql_enable | default(false) }}"
backup__mysql_compress: "{{ backup_mysql_compress | default(true) }}"
backup__mysql_replication: "{{ backup_mysql_replication | default(false) }}"
backup__mysql_backup_dir: "{{ backup_mysql_backup_dir | default('/var/backups/mysql') }}"
backup__mysql_host: "{{ backup_mysql_host | default('localhost') }}"
backup__mysql_user: "{{ backup_mysql_user | default('_backup_') }}"
backup__mysql_password: "{{ backup_mysql_password | default('') }}"
backup__mysql_dump_options: "{{ backup_mysql_dump_options | default('') }}"
backup__mysql_ignore_databases: "{{ backup_mysql_ignore_databases | default(backup__mysql_ignore_databases_default) }}"
backup__mysql_keep_days: "{{ backup_mysql_keep_days | default('14') }}"

#
# OpenLDAP variables
#
backup__openldap_enable: "{{ backup_openldap_enable | default(false) }}"
backup__openldap_compress: "{{ backup_openldap_compress | default(true) }}"
backup__openldap_backup_dir: "{{ backup_openldap_backup_dir | default('/var/backups/openldap') }}"
backup__openldap_keep_days: "{{ backup_openldap_keep_days | default('14') }}"

#
# PostgreSQL variables
#
backup__postgresql_enable: "{{ backup_postgresql_enable | default(false) }}"
backup__postgresql_compress: "{{ backup_postgresql_compress | default(true) }}"
backup__postgresql_backup_dir: "{{ backup_postgresql_backup_dir | default('/var/backups/postgresql') }}"
backup__postgresql_user: "{{ backup_postgresql_user | default('postgres') }}"
backup__postgresql_ignore_databases: "{{ backup_postgresql_ignore_databases | default(backup__postgresql_ignore_databases_default) }}"
backup__postgresql_keep_days: "{{ backup_postgresql_keep_days | default('14') }}"

#
# Do not change from here
#
backup__ssh_key_path: "/tmp/{{ backup__ssh_key_name }}"
#backup__borg_rsh_default: "ssh -i ~/.ssh/{{ backup__ssh_key_name }} -oStrictHostKeyChecking=no"
backup__borg_rsh_default: "ssh -i ~/.ssh/{{ backup__ssh_key_name }}"
backup__borg_exclude_default: []
backup__borg_include_default:
- /etc
- /home
- /root
- /usr/local/etc
- /var/log

backup__mysql_ignore_databases_default:
- information_schema
- performance_schema
- sys

backup__postgresql_ignore_databases_default:
- template0
- template1

backup__ssh_client_packages:
- sshpass
- lftp

backup__borg_packages:
- borgbackup

backup__mysql_packages:
- mariadb-client

backup__logrotate_files:
  - name: backup
    definitions:
      - logs:
          - "{{ backup__logfile }}"
          - "{{ backup__error_logfile }}"
        options:
          - daily
          - rotate 28
          - compress
          - delaycompress
          - missingok
          - notifempty
