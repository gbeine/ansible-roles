---

- name: Create accounts
  tags: [ 'bootstrap_accounts'  ]
  block:

    - name: Create groups
      ansible.builtin.group:
        name: "{{ item.key }}"
        gid: "{{ item.value.gid }}"
        system: "{{ item.value.system | default(false) }}"
      with_dict: "{{ bootstrap_accounts__groups }}"

    - name: Create users
      ansible.builtin.user:
        name: "{{ item.key }}"
        uid: "{{ item.value.uid }}"
        comment: "{{ item.value.comment | default('') }}"
        create_home: "{{ item.value.create_home | default(false) }}"
        group: "{{ item.value.group | default(item.key) }}"
        home: "{{ item.value.home | default('/nonexistent') }}"
        shell: "{{  item.value.shell | default('/usr/bin/false') }}"
        system: "{{ item.value.system | default(false) }}"
      with_dict: "{{ bootstrap_accounts__users }}"
