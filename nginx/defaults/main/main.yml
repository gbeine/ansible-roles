---
# tasks file for defaults/nginx

nginx_sites: []
nginx_packages: []
nginx_http_options: {}
nginx_snippets: {}

#
# Substitutions
#

nginx__enable: "{{ nginx_enable | default(false) }}"
nginx__flavor: "{{ nginx_flavor | default('light') }}"
nginx__pki_enable: "{{ nginx_pki_enable | default(false) }}"

nginx__etc_path: "{{ nginx_etc_path | default('/etc/nginx') }}"
nginx__run_path: "{{ nginx_run_path | default('/run') }}"
nginx__log_path: "{{ nginx_log_path | default('/var/log/nginx') }}"
nginx__www_path: "{{ nginx_www_path | default('/var/www') }}"
nginx__conf_path: "{{ nginx__etc_path }}/conf.d"
nginx__snippets_path: "{{ nginx__etc_path }}/snippets"
nginx__sites_available_path: "{{ nginx__etc_path }}/sites-available"
nginx__sites_enabled_path: "{{ nginx__etc_path }}/sites-enabled"

nginx__user: "{{ nginx_user | default('www-data') }}"
nginx__group: "{{ nginx_group | default('www-data') }}"
nginx__site_mode: "{{ nginx_site_mode | default('0750') }}"

nginx__worker_priority: "{{ nginx_worker_priority | default(0) }}"
nginx__worker_processes: "{{ nginx_worker_processes | default(ansible_processor_vcpus) }}"
nginx__worker_rlimit_nofile: "{{ nginx_worker_rlimit_nofile | default(4096) }}"
nginx__worker_connections: "{{ nginx_worker_connections | default(1024) }}"
nginx__multi_accept: "{{ nginx_multi_accept | default('off') }}"

nginx__http_server_tokens: "{{ nginx_http_server_tokens | default('off') }}"
nginx__http_server_names_hash_bucket_size: "{{ nginx_http_server_names_hash_bucket_size | default(64) }}"
nginx__http_server_names_hash_max_size: "{{ nginx_http_server_names_hash_max_size | default(512) }}"

nginx__php_enable: "{{ nginx_php_enable | default(false) }}" 
nginx__php_server: "{{ nginx_php_server | default('unix:/run/php/php-fpm.sock') }}" 

nginx__ssl_protocols: "{{ nginx_ssl_protocols | default(nginx__ssl_protocols_default) }}"
nginx__ssl_prefer_server_ciphers: "{{ (nginx__ssl_protocols|length == 1 and nginx__ssl_protocols[0] == 'TLSv1.3') | ternary('on','off') }}"
nginx__ssl_ciphers: "{{ nginx_ssl_ciphers | default(nginx__ssl_ciphers_default) }}"
nginx__ssl_dhparam: "{{ nginx_ssl_dhparam | default('') }}"
nginx__ssl_curve: "{{ nginx_ssl_curve | default('secp384r1') }}"
nginx__ssl_session_cache: "{{ nginx_ssl_session_cache | default('shared:SSL:10m') }}"
nginx__ssl_session_timeout: "{{ nginx_ssl_session_timeout | default('5m') }}"
nginx__ssl_session_tickets: "{{ nginx_ssl_session_tickets | default('off') }}"

nginx__locations: "{{ nginx_locations | default({}) }}"
nginx__sites: "{{ nginx_sites | default([]) }}"

#
# Do not change from here
#

nginx__flavor_map:
  light:
    packages:
    - nginx-light
  full:
    packages:
    - nginx-full

nginx__flavor_selected: "{{ nginx__flavor_map[nginx__flavor] }}"

nginx__index_default:
- index.html
- index.htm
- index.nginx-debian.html

nginx__servers_default: []
nginx__packages_default: []
nginx__http_options_default:
  sendfile: 'on'
  tcp_nopush: 'on'
  tcp_nodelay: 'on'
  types_hash_max_size: 2048
  gzip: 'on'
  gzip_disable: msie6
  gzip_comp_level: 5
  gzip_min_length: 256
  gzip_proxied: any
  gzip_vary: 'on'
  gzip_types: "\n{{ nginx__gzip_types_default | join('\n') | indent(10, true) }}"

nginx__gzip_types_default:
- application/atom+xml
- application/javascript
- application/json
- application/ld+json
- application/manifest+json
- application/rss+xml
- application/vnd.geo+json
- application/vnd.ms-fontobject
- application/x-font-ttf
- application/x-web-app-manifest+json
- application/xhtml+xml
- application/xml
- font/opentype
- image/bmp
- image/svg+xml
- image/x-icon
- text/cache-manifest
- text/css
- text/plain
- text/vnd.rim.location.xloc
- text/vtt
- text/x-component
- text/x-cross-domain-policy

nginx__ssl_protocols_default:
- TLSv1.2
- TLSv1.3

nginx__ssl_ciphers_default:
- ECDHE-ECDSA-AES128-GCM-SHA256
- ECDHE-RSA-AES128-GCM-SHA256
- ECDHE-ECDSA-AES256-GCM-SHA384
- ECDHE-RSA-AES256-GCM-SHA384
- ECDHE-ECDSA-CHACHA20-POLY1305
- ECDHE-RSA-CHACHA20-POLY1305
- DHE-RSA-AES128-GCM-SHA256
- DHE-RSA-AES256-GCM-SHA384

nginx__packages_combined: "{{ nginx_packages + nginx__packages_default + nginx__flavor_selected['packages'] }}"
nginx__http_options_combined: "{{ nginx__http_options_default | combine(nginx_http_options) }}"
