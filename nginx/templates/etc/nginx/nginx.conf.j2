###
### {{ ansible_managed }}
###

user {{ nginx__user }};

pid {{ nginx__run_path }}/nginx.pid;

include /etc/nginx/modules-enabled/*.conf;

# Default error_log
error_log {{ nginx__log_path }}/error.log;

# Nicenness, from 20 (nice) to -20 (not nice)
worker_priority {{ nginx__worker_priority }};

# Number of workers to run, usually equals number of CPU cores
worker_processes {{ nginx__worker_processes }};

# Maximum number of opened files per process, must be higher than worker_connections
worker_rlimit_nofile {{ nginx__worker_rlimit_nofile }};

events {
        worker_connections  {{ nginx__worker_connections }};
        multi_accept  {{ nginx__multi_accept }};
}

http {
        include {{ nginx__conf_path }}/*.conf;
        include {{ nginx__etc_path }}/mime.types;
        default_type application/octet-stream;

        server_tokens {{ nginx__http_server_tokens }};

        server_names_hash_bucket_size {{ nginx__http_server_names_hash_bucket_size }};
        server_names_hash_max_size {{ nginx__http_server_names_hash_max_size }};

{% for option, value in nginx__http_options_combined.items() %}
        {{ option }} {{ value }};
{% endfor %}

        # Logging
        access_log {{ nginx__log_path }}/access.log;
        error_log  {{ nginx__log_path }}/error.log;

        # Virtual Hosts Configs
        include {{ nginx__sites_enabled_path }}/*.conf;
}

# vim:ft=nginx
