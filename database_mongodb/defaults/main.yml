---

#
# Substitutes - do not change
#

database_mongodb__username: "{{ mongodb_username | mandatory }}"
database_mongodb__password: "{{ mongodb_password | mandatory }}"

database_mongodb__version: "{{ mongodb_version | default('latest') }}"

database_mongodb__accounts: "{{ mongodb_accounts | default([]) }}"

database_mongodb__use_podman: "{{ mongodb_use_podman | default(false) }}"

database_mongodb__podman_hostname: "{{ mongodb_pod_hostname | default('mongodb.' + dns_hostname) }}"
database_mongodb__podman_ip: "{{ mongodb_pod_ip | mandatory }}"
database_mongodb__podman_network: "{{ mongodb_pod_net | mandatory }}"
database_mongodb__podman_home: "{{ mongodb_pod_home | mandatory }}"

#
# Defaults - do not change
#

database_mongodb__etc_dir: "{{ database_mongodb__podman_home + '/etc' if database_mongodb__use_podman else '/etc/mongo' }}"
database_mongodb__data_dir: "{{ database_mongodb__podman_home + '/data' if database_mongodb__use_podman else '/var/lib/mongodb' }}"

database_mongodb__podman_packages: "{{ database_mongodb__podman_packages_default[bootstrap_ansible__distribution] | default([]) }}"

database_mongodb__podman_packages_default:
  Debian:
    - python3-pip

database_mongodb__podman_container: "{{ database_mongodb__podman_container_default | combine(mongodb_container | default({})) }}"

# this configuration is used when MySQL/MariaDB is installed as a podman container
database_mongodb__podman_container_default:
  name: mongodb
  hostname: "{{ database_mongodb__podman_hostname }}"
  image: "docker.io/library/mongo:{{ database_mongodb__version }}"
  ip: "{{ database_mongodb__podman_ip }}"
  network: "{{ database_mongodb__podman_network }}"
  restart_policy: always
  environment:
    - MONGO_INITDB_ROOT_USERNAME: "{{ database_mongodb__username }}"
    - MONGO_INITDB_ROOT_PASSWORD: "{{ database_mongodb__password }}"
  volumes:
    - "{{ database_mongodb__etc_dir }}:/etc/mongo"
    - "{{ database_mongodb__data_dir }}:/data/db"
