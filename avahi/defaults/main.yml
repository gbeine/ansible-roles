---
# defaults file for roles/avahi

avahi_packages: []
avahi_services: {}

#
# Substitutions
#

avahi__enable: "{{ avahi_enable | default (false) }}"

# [server]
avahi__host: "{{ avahi_host | default (ansible_hostname) }}"
avahi__domain: "{{ avahi_domain | default ('local') }}"
avahi__browse_domains: "{{ avahi_browse_domains | default ([]) }}"
avahi__use_ipv4: "{{ avahi_use_ipv4 | default (true) }}"
avahi__use_ipv6: "{{ avahi_use_ipv6 | default (true) }}"
avahi__allow_interfaces: "{{ avahi_allow_interfaces | default (['lo']) }}"
avahi__deny_interfaces: "{{ avahi_deny_interfaces | default ([]) }}"
avahi__check_response_ttl: "{{ avahi_check_response_ttl | default (false) }}"
avahi__use_iff_running: "{{ avahi_use_iff_running | default (false) }}"
avahi__enable_dbus: "{{ avahi_enable_dbus | default (true) }}"
avahi__disallow_other_stacks: "{{ avahi_disallow_other_stacks | default (true) }}"
avahi__ratelimit_interval_usec: "{{ avahi_ratelimit_interval_usec | default (1000000) }}"
avahi__ratelimit_burst: "{{ avahi_ratelimit_burst | default (1000) }}"

# [publish]
avahi__disable_publishing: "{{ avahi_disable_publishing | default (true) }}"
avahi__disable_user_service_publishing: "{{ avahi_disable_user_service_publishing | default (true) }}"
avahi__add_service_cookie: "{{ avahi_add_service_cookie | default (true) }}"
avahi__publish_hinfo: "{{ avahi_publish_hinfo | default (false) }}"
avahi__publish_workstation: "{{ avahi_publish_workstation | default (false) }}"

# [wide-area]
avahi__wide_area: "{{ avahi_wide_area | default (false) }}"

# [reflector]
avahi__reflector: "{{ avahi_reflector | default (false) }}"
avahi__reflect_ipv: "{{ avahi_reflect_ipv | default (false) }}"

# [rlimits]
avahi__rlimit_as: "{{ avahi_rlimit_as | default ('') }}"
avahi__rlimit_core: "{{ avahi_rlimit_core | default (0) }}"
avahi__rlimit_data: "{{ avahi_rlimit_data | default (8388608) }}"
avahi__rlimit_fsize: "{{ avahi_rlimit_fsize | default (0) }}"
avahi__rlimit_nofile: "{{ avahi_rlimit_nofile | default (768) }}"
avahi__rlimit_stack: "{{ avahi_rlimit_stack | default (8388608) }}"
avahi__rlimit_nproc: "{{ avahi_rlimit_nproc | default (3) }}"

# services
avahi__publish_device_info: "{{ avahi_publish_device_info | default(not avahi__publish_workstation) }}"
avahi__publish_ssh: "{{ avahi_publish_ssh | default (true) }}"

#
# Do not change from here
#

avahi__packages_default: "{{ avahi__packages_default_flavors[ansible_distribution | lower] }}"

avahi__packages_default_flavors:
  debian:
  - avahi-daemon
  - avahi-utils
  - libnss-mdns
  - python3-avahi
  ubuntu:
  - avahi-daemon
  - avahi-utils
  - libnss-mdns
  - python-avahi

avahi__services_default:
  device-info:
    comment: Set server icon for this host on compatible devices
    type: _device-info._tcp
    txt: model=RackMac
    state: "{{ 'present'
               if avahi__publish_device_info|bool
               else 'absent' }}"
  sftp-ssh:
    name: SFTP on %h
    type: _sftp-ssh._tcp
    port: 22
    state: "{{ 'present'
               if avahi__publish_ssh|bool
               else 'absent' }}"
  ssh:
    name: SSH on %h
    type: _ssh._tcp
    port: 22
    state: "{{ 'present'
               if avahi__publish_ssh|bool
               else 'absent' }}"

avahi__packages_combined: "{{ avahi__packages_default + avahi_packages }}"
avahi__services_combined: "{{ avahi__services_default | combine(avahi_services) }}"
